var A=Object.defineProperty,Se=Object.defineProperties,he=Object.getOwnPropertyDescriptor,Ae=Object.getOwnPropertyDescriptors,Ie=Object.getOwnPropertyNames,$=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,Ce=Object.prototype.propertyIsEnumerable;var F=(e,t,o)=>t in e?A(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,D=(e,t)=>{for(var o in t||(t={}))L.call(t,o)&&F(e,o,t[o]);if($)for(var o of $(t))Ce.call(t,o)&&F(e,o,t[o]);return e},W=(e,t)=>Se(e,Ae(t));var i=(e,t)=>()=>(e&&(t=e(e=0)),t);var j=(e,t)=>{for(var o in t)A(e,o,{get:t[o],enumerable:!0})},Pe=(e,t,o,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Ie(t))!L.call(e,n)&&n!==o&&A(e,n,{get:()=>t[n],enumerable:!(r=he(t,n))||r.enumerable});return e};var K=e=>Pe(A({},"__esModule",{value:!0}),e);function k(e,t){let o=`${q}`;return q+=1,p[o]={handler:t,name:e},function(){delete p[o]}}function d(e,t){let o=!1;return k(e,function(...r){o!==!0&&(o=!0,t(...r))})}function V(e,t){for(let o in p)p[o].name===e&&p[o].handler.apply(null,t)}var p,q,b,z=i(()=>{p={},q=0;b=typeof window=="undefined"?function(e,...t){figma.ui.postMessage([e,...t])}:function(e,...t){window.parent.postMessage({pluginMessage:[e,...t]},"*")};typeof window=="undefined"?figma.ui.onmessage=function([e,...t]){V(e,t)}:window.onmessage=function(e){if(typeof e.data.pluginMessage=="undefined")return;let[t,...o]=e.data.pluginMessage;V(t,o)}});function O(e){return{imageHash:figma.createImage(e).hash,scaleMode:"FILL",scalingFactor:.5,type:"IMAGE"}}var X=i(()=>{});function w(e){return{x:e.absoluteTransform[0][2],y:e.absoluteTransform[1][2]}}var J=i(()=>{});function I(e,t,o){if(e.removed!==!0){if("children"in e&&(typeof o!="function"||o(e)===!1))for(let r of e.children)I(r,t,o);t(e)}}var Q=i(()=>{});function f(e){let t=e.parent;if(t===null)throw new Error("`node.parent` is `null`");return t}var g=i(()=>{});function M(e,t){let o=f(t),r=o.children.indexOf(t);o.insertChild(r+1,e)}var Y=i(()=>{g()});function c(e){if(e.length<2)return!0;let[t,...o]=e,r=f(t);for(let n of o)if(n.parent===null||n.parent.id!==r.id)return!1;return!0}var C=i(()=>{g()});function v(e){if(e.length<2)return e.slice();let t=f(e[0]);if(c(e)===!1)throw new Error("Nodes in `siblingNodes` do not have the same parent");return e.slice().map(function(o){return{index:t.children.indexOf(o),node:o}}).sort(function(o,r){return o.index-r.index}).map(function({node:o}){return o})}var Z=i(()=>{g();C()});function ee(e,t){if(e.length!==t.length)return!1;for(let o in e)if(e[o]!==t[o])return!1;return!0}var te=i(()=>{});function _(e){let t=f(e[0]);if(c(e)===!1)throw new Error("Nodes in `siblingNodes` do not have the same parent");let o=e.slice(),r=t.children.map(function({id:s}){return s}),n=Ee(o,r);for(let s of o)t.insertChild(n,s);let a=t.children.map(function({id:s}){return s});return ee(r,a)===!1}function Ee(e,t){let o=-1;for(let r of e){let n=t.indexOf(r.id);n>o&&(o=n)}return o+1}var oe=i(()=>{te();g();C()});async function x(e,t=re){let o=await figma.clientStorage.getAsync(t);return typeof o=="undefined"?e:Object.assign({},e,o)}async function U(e,t=re){await figma.clientStorage.setAsync(t,e)}var re,ne=i(()=>{re="settings"});function y(e){return`${be} ${T} ${e}`}function B(e){return`${Oe} ${T} ${e}`}function G(e){return`${we} ${T} ${e}`}var be,Oe,we,T,ie=i(()=>{be="\u2714",Oe="\u2718",we="\u26A0",T="\xA0"});function N(e,t){if(typeof __html__=="undefined")throw new Error("No UI defined");let o=`<div id="create-figma-plugin"></div><script>document.body.classList.add('theme-${figma.editorType}');const __FIGMA_COMMAND__='${typeof figma.command=="undefined"?"":figma.command}';const __SHOW_UI_DATA__=${JSON.stringify(typeof t=="undefined"?{}:t)};${__html__}</script>`;figma.showUI(o,W(D({},e),{themeColors:typeof e.themeColors=="undefined"?!0:e.themeColors}))}var se=i(()=>{});var l=i(()=>{z();X();J();Y();C();Z();oe();Q();ne();ie();se()});function ae(e,t){let{bytes:o,x:r,y:n,width:a,height:s}=e,{resolution:m,xOffset:E,yOffset:h}=t,u=figma.createRectangle();return u.name="Image",u.x=r/m+E,u.y=n/m+h,u.resize(a/m,s/m),u.fills=[O(o)],u}var fe=i(()=>{l()});var S,P,R=i(()=>{"use strict";S="2021-05-01",P={resolution:2}});function H(e){if(c(e)===!1)return figma.group(e,figma.currentPage);let t=e[0].parent;if(t===null)throw new Error("Node has no parent");let o=v(e),r=o[o.length-1],n=t.children.indexOf(r),a=figma.group(e,t,n);return a.name=e.length===1?r.name:"Group",a}var ce=i(()=>{"use strict";l()});async function me(e,t){let o={constraint:{type:"SCALE",value:t},format:"PNG"};return e.exportAsync(o)}var ue=i(()=>{"use strict"});function de(e){return e.map(function(t){if((Me(t)===!0||le(t)===!0)&&"clone"in t){let o=t.clone(),{x:r,y:n}=w(t);return o.x=r,o.y=n,t.visible=!1,o}return t})}function Me(e){let t=!1;return I(e,function(o){t===!1&&o.type==="COMPONENT"&&(t=!0)},function(o){return t===!0||o.type==="COMPONENT"||o.type==="INSTANCE"}),t}function le(e){let t=e.parent;return t===null||t.type==="DOCUMENT"||t.type==="PAGE"?!1:t.type==="INSTANCE"?!0:le(t)}var pe=i(()=>{"use strict";l()});var ge={};j(ge,{default:()=>ve});async function ve(){if(figma.currentPage.selection.length===0){figma.closePlugin(B("Select one or more layers"));return}let{resolution:e}=await x(P,S),t=de(figma.currentPage.selection.slice()),o=H(t);d("SPLIT_IMAGE_RESULT",function(n){let a=[];for(let E of n){let h=ae(E,{resolution:e,xOffset:o.x,yOffset:o.y});M(h,o),a.push(h)}let s;a.length===1?s=a[0]:(_(a),s=H(a),s.name="Image");let m=s.width!==o.width||s.height!==o.height;o.remove(),figma.currentPage.selection=[s],figma.closePlugin(m===!0?G(`Flattened at ${e}x; position on canvas may have changed`):y(`Flattened at ${e}x`))}),N({height:132,width:240});let r=await me(o,e);b("SPLIT_IMAGE_REQUEST",r)}var xe=i(()=>{"use strict";l();fe();R();ce();ue();pe()});var ye={};j(ye,{default:()=>_e});async function _e(){let e=await x(P,S);d("CLOSE_UI",function(){figma.closePlugin()}),d("SUBMIT",async function(t){await U(t,S),figma.closePlugin(y("Saved settings"))}),N({height:132,title:"Settings",width:240},e)}var Ne=i(()=>{"use strict";l();R()});var Ue={"src/flatten-selection-to-bitmap/main.ts--default":(xe(),K(ge)).default,"src/settings/main.ts--default":(Ne(),K(ye)).default},Te=typeof figma.command=="undefined"||figma.command===""?"src/flatten-selection-to-bitmap/main.ts--default":figma.command;Ue[Te]();
